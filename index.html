<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>City of Tyler – Integrated Traffic Operations Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#0b1220;--panel:#121a2f;--accent:#00c2ff;
--danger:#ff4d4d;--warning:#ffb703;--success:#2ec4b6;
--text:#e6e9ef;--muted:#9aa4bf;
}
*{box-sizing:border-box;font-family:Segoe UI,Roboto,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}
header{padding:14px 22px;background:linear-gradient(90deg,#0b1220,#121a2f);
display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #1f2a48}
header h1{margin:0;font-size:20px}
header span{color:var(--accent)}

.dashboard{display:grid;grid-template-columns:330px 1fr 380px;height:calc(100vh - 64px)}
.panel{background:var(--panel);border-right:1px solid #1f2a48;padding:14px;overflow:auto}
.panel h2{font-size:15px;color:var(--accent);margin:10px 0}

.kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.kpi{background:#0e1730;padding:10px;border-radius:6px}
.kpi h3{margin:0;font-size:12px;color:var(--muted)}
.kpi p{margin:4px 0 0;font-size:18px}

.toggle label{display:block;font-size:13px;margin-bottom:4px}
.toggle input{margin-right:6px}

.list-item{background:#0e1730;padding:10px;margin-bottom:8px;
border-left:4px solid var(--accent);border-radius:6px;font-size:13px}
.danger{border-color:var(--danger)}
.warning{border-color:var(--warning)}

#map{height:100%;width:100%}

.insight{background:#0e1730;padding:10px;border-radius:6px;
margin-bottom:8px;border-left:4px solid var(--success)}

canvas{background:#0e1730;border-radius:6px;padding:8px}

footer{position:fixed;bottom:0;left:0;right:0;background:#0e1730;
padding:6px 14px;font-size:12px;color:var(--muted);display:flex;justify-content:space-between}
</style>
</head>

<body>

<header>
<h1>City of Tyler <span>Integrated Traffic Operations Center</span></h1>
<div>
Time Mode:
<select id="timeMode">
<option>Night</option>
<option>AM Peak</option>
<option>Midday</option>
<option>PM Peak</option>
</select>
</div>
</header>

<div class="dashboard">

<!-- LEFT -->
<div class="panel">
<h2>Citywide KPIs</h2>
<div class="kpis">
<div class="kpi"><h3>Avg Speed</h3><p id="speed">32 mph</p></div>
<div class="kpi"><h3>Delay Index</h3><p id="delay">1.31</p></div>
<div class="kpi"><h3>Active Alerts</h3><p style="color:var(--danger)">14</p></div>
<div class="kpi"><h3>Signal Health</h3><p style="color:var(--success)">88%</p></div>
</div>

<h2>Layer Controls</h2>
<div class="toggle">
<label><input type="checkbox" checked> Waze Traffic</label>
<label><input type="checkbox" checked> PD</label>
<label><input type="checkbox" checked> Fire</label>
<label><input type="checkbox" checked> Traffic</label>
<label><input type="checkbox" checked> Streets</label>
<label><input type="checkbox" checked> Engineering</label>
<label><input type="checkbox" checked> Weather (NWS)</label>
<label><input type="checkbox" checked> TxDOT</label>
</div>

<h2>Active Alerts</h2>
<div class="list-item danger"><strong>Crash – Broadway Ave</strong> PD & Fire responding</div>
<div class="list-item warning"><strong>Heavy Rain</strong> Reduced visibility</div>
<div class="list-item"><strong>Lane Closure – Loop 323</strong> TxDOT</div>
</div>

<!-- MAP -->
<div id="map"></div>

<!-- RIGHT -->
<div class="panel">
<h2>Operational Trends</h2>
<canvas id="speedChart"></canvas>
<canvas id="delayChart" style="margin-top:10px"></canvas>

<h2>Department Insights</h2>
<div class="insight"><strong>PD:</strong> Crash density elevated near UT Tyler</div>
<div class="insight"><strong>Fire:</strong> Signal preemption effective on Broadway</div>
<div class="insight"><strong>Traffic:</strong> PM timing plan active</div>
<div class="insight"><strong>Streets:</strong> Rain increasing pothole reports</div>
<div class="insight"><strong>Engineering:</strong> Corridor reliability trending down</div>

<h2>AI City Advisor</h2>
<div class="insight" style="border-color:var(--accent)">
PM peak + rain detected. Recommend public advisory, extend green splits on arterials, and coordinate PD presence at crash-prone intersections.
</div>
</div>

</div>

<footer>
<div>Simulated Feeds: Waze • NWS/NOAA • TxDOT • City of Tyler</div>
<div id="clock"></div>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map=L.map('map').setView([32.3513,-95.3011],12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

/* Waze-style jam lines */
const jams=[
[[32.34,-95.29],[32.36,-95.31]],
[[32.33,-95.30],[32.35,-95.32]]
];
jams.forEach(j=>{
L.polyline(j,{color:'#ff4d4d',weight:6,opacity:.8}).addTo(map);
});

/* Weather zones */
L.circle([32.37,-95.28],{radius:1500,color:'#00c2ff',fillOpacity:.2}).addTo(map)
.bindPopup("Heavy Rain – NWS");

/* Incidents */
L.marker([32.351,-95.301]).addTo(map).bindPopup("Major Crash – PD / Fire");
L.marker([32.36,-95.32]).addTo(map).bindPopup("TxDOT Lane Closure");

/* Charts */
new Chart(document.getElementById("speedChart"),{
type:"line",
data:{labels:["-60","-45","-30","-15","Now"],
datasets:[{label:"Avg Speed (mph)",data:[38,36,34,33,32],borderColor:"#2ec4b6"}]},
options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:false}}}
});

new Chart(document.getElementById("delayChart"),{
type:"line",
data:{labels:["-60","-45","-30","-15","Now"],
datasets:[{label:"Delay Index",data:[1.1,1.2,1.25,1.29,1.31],borderColor:"#ffb703"}]},
options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:false}}}
});

/* Clock */
setInterval(()=>document.getElementById("clock").innerText=new Date().toLocaleString(),1000);
</script>

</body>
</html>
